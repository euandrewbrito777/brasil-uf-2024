<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Brasil UF 2024 - Mapa</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    #map {
      width: 100%;
      height: 100vh;
    }
    .leaflet-container {
      background: #0b1020;
    }

    /* Caixa de busca */
    .search-container {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.95);
      padding: 8px 10px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      display: flex;
      gap: 6px;
      align-items: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    .search-container input {
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 4px 6px;
      font-size: 13px;
      min-width: 180px;
    }

    .search-container button {
      border: none;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 13px;
      cursor: pointer;
      background: #2563eb;
      color: #fff;
    }

    .search-container button:hover {
      background: #1d4ed8;
    }

    .search-hint {
      font-size: 11px;
      color: #555;
      margin-top: 2px;
    }
  </style>
</head>
<body>
  <!-- Caixa de busca -->
  <div class="search-container">
    <div>
      <input
        id="stateSearch"
        type="text"
        placeholder="Buscar estado (SP, São Paulo...)"
      />
      <button id="stateSearchBtn">Buscar</button>
      <div class="search-hint">Digite sigla ou nome completo/parcial</div>
    </div>
  </div>

  <div id="map"></div>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <!-- topojson-client para converter TopoJSON em GeoJSON -->
  <script src="https://unpkg.com/topojson-client@3/dist/topojson-client.min.js"></script>

  <script>
    // URL do seu TopoJSON no GitHub Pages
    const TOPOJSON_URL =
      "https://euandrewbrito777.github.io/brasil-uf-2024/br_uf_2024_topojson.json";

    // Cria o mapa
    const map = L.map("map").setView([-15.8, -47.9], 4); // centro aproximado do Brasil

    // Fundo básico (OpenStreetMap)
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 18,
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    let ufLayer = null;
    const featureLayers = []; // para indexar cada UF e usar na busca

    // Carrega o TopoJSON
    fetch(TOPOJSON_URL)
      .then((response) => {
        if (!response.ok) {
          throw new Error("Erro ao baixar TopoJSON: " + response.status);
        }
        return response.json();
      })
      .then((topology) => {
        // Pega o primeiro objeto do TopoJSON (assumindo que só tem um)
        const objectName = Object.keys(topology.objects)[0];
        const geojson = topojson.feature(topology, topology.objects[objectName]);

        ufLayer = L.geoJSON(geojson, {
          style: {
            color: "#ffffff",      // cor da borda
            weight: 1.2,           // espessura da linha
            fillColor: "#1f78b4",  // cor de preenchimento
            fillOpacity: 0.6
          },
          onEachFeature: (feature, layer) => {
            const sigla = feature.properties.SIGLA_UF || "";
            const nome = feature.properties.NM_UF || "";
            layer.bindPopup(`<b>${sigla}</b><br>${nome}`);

            // guarda referência para usar na busca
            featureLayers.push(layer);
          }
        }).addTo(map);

        map.fitBounds(ufLayer.getBounds());
      })
      .catch((err) => {
        console.error(err);
        alert("Erro ao carregar o mapa. Veja o console para detalhes.");
      });

    // Função de busca
    function searchState() {
      const input = document.getElementById("stateSearch");
      const query = (input.value || "").trim().toLowerCase();

      if (!query || !featureLayers.length) return;

      let foundLayer = null;

      for (const layer of featureLayers) {
        const props = layer.feature.properties || {};
        const sigla = (props.SIGLA_UF || "").toLowerCase();
        const nome = (props.NM_UF || "").toLowerCase();

        // combinações: sigla exata, nome exato ou nome contendo o texto
        if (
          sigla === query ||
          nome === query ||
          nome.includes(query)
        ) {
          foundLayer = layer;
          break;
        }
      }

      if (foundLayer) {
        map.fitBounds(foundLayer.getBounds(), { maxZoom: 7 });
        foundLayer.openPopup();
      } else {
        alert("Nenhum estado encontrado para: " + input.value);
      }
    }

    // Eventos de busca (botão + Enter)
    document.getElementById("stateSearchBtn").addEventListener("click", searchState);

    document.getElementById("stateSearch").addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        searchState();
      }
    });
  </script>
</body>
</html>
